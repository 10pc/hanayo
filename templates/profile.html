{{ define "tpl" }}
<div class="ui container">
	{{ if .UserID }}
		{{ $gqm := atoi (.Gin.Query "mode") }}
		{{ $global := . }}
		{{ with (.Get "users/full?id=%d" .UserID) }}
			{{ $favouritemode := or $gqm .favourite_mode }}
			<script>
				window.favouriteMode = {{ $favouritemode }};
				window.userID = '{{ .id }}';
			</script>
			{{ if hasAdmin $global.Context.User.Privileges }}
				{{ $restr := not (has .privileges 1) }}
				{{ $disab := not (has .privileges 2) }}
				{{ if and $disab $restr }}
					<div class="ui negative centered message">User is <b>banned</b>.</div>
				{{ else if $restr }}
					<div class="ui negative centered message">User is <b>restricted</b>.</div>
				{{ else if $disab }}
					<div class="ui negative centered message">User is <b>disabled</b>.</div>									
				{{ end }}
			{{ end }}
			{{ with $global.Get "users/userpage?id=%.0f" .id }}
				{{ if .userpage }}
					<div class="ui raised segment">
						{{ html (parseUserpage .userpage) }}
					</div>
				{{ end }}
			{{ end }}
			<div class="ui top attached segment overflow auto">
				<div class="magic table">
					<div class="table element">
						<img src="{{ avatars }}/{{ .id }}" alt="avatar" class="user avatar">
					</div>
					<div class="table element">
						<h1>{{ .username }}</h1>
						{{ if .username_aka }}<div class="subtitle">(aka <b>{{ .username_aka }}</b>)</div>{{ end }}
					</div>
				</div>
				<div class="magic table floating right">
					<div class="table element">
						{{ if .std.global_leaderboard_rank }}
							{{ range $k, $v := (slice .std .taiko .ctb .mania) }}
								<h1 data-mode="{{ $k }}"{{ if ne $k (int $favouritemode) }} hidden{{ end }}>#{{ .global_leaderboard_rank }}</h1>
							{{ end }}
						{{ else }}
								<h1>Unknown</h1>							
						{{ end }}
					</div>
				</div>
			</div>
			<div class="ui four item bottom attached menu" id="mode-menu">
				<a class="{{ favMode $favouritemode 0 }}item" data-mode="0" href="/u/{{ .id }}?mode=0">osu! standard</a>
				<a class="{{ favMode $favouritemode 1 }}item" data-mode="1" href="/u/{{ .id }}?mode=1">Taiko</a>
				<a class="{{ favMode $favouritemode 2 }}item" data-mode="2" href="/u/{{ .id }}?mode=2">Catch the Beat</a>
				<a class="{{ favMode $favouritemode 3 }}item" data-mode="3" href="/u/{{ .id }}?mode=3">osu!mania</a>
			</div>
			{{ $user := . }}
			<div class="ui three column divided segment grid">
				<div class="row">
					<div class="column">
						<b>{{ .username }}</b> is a Ripple player{{ with country .country }} from <b>{{ . }}</b>{{ end }}. 
						They signed up on Ripple {{ time $user.registered_on }}.
						Last seen: {{ time $user.latest_activity }}.
					</div>
					<div class="column">
						{{ if and (not .badges) (not .custom_badge) }}
							This user hasn't got any badges!
						{{ else }}
							<div class="ui grid">
								{{ range .badges }}
									<div class="eight wide centered column">
										<i class="circular {{trimPrefix .icon "fa-"}} big icon"></i><br>
										<b>{{ .name }}</b>
									</div>
								{{ end }}
								{{ with .custom_badge }}
									<div class="eight wide centered column">
										<i class="circular {{trimPrefix .icon "fa-"}} big icon"></i><br>
										<b><i>{{ .name }}</i></b>
									</div>
								{{ end }}
							</div>
						{{ end }}
					</div>
					<div class="column">
						{{ range $k, $v := (slice .std .taiko .ctb .mania) }}
							<div data-mode="{{ $k }}" {{ if ne $k (int $favouritemode) }} hidden{{ end }}>
								<table class="ui very basic two column compact table nopad">
									<tbody>
										<tr>
											<td><b>PP</b></td>
											<td>{{ humanize .pp }}</td>
										</tr>
										<tr>
											<td><b>Ranked score</b></td>
											<td>{{ humanize .ranked_score }}</td>
										</tr>
										<tr>
											<td><b>Total score</b></td>
											<td>{{ humanize .total_score }}</td>
										</tr>
										<tr>
											<td><b>Playcount</b></td>
											<td>{{ humanize .playcount }}</td>
										</tr>
										<tr>
											<td><b>Replays watched</b></td>
											<td>{{ humanize .replays_watched }}</td>
										</tr>
										<tr>
											<td><b>Total hits</b></td>
											<td>{{ humanize .total_hits }}</td>
										</tr>									<tr>
											<td><b>Accuracy</b></td>
											<td>{{ printf "%.2f" .accuracy }}%</td>
										</tr>
									</tbody>
								</table>
								<div class="ui blue progress little margin top" data-percent="{{ levelPercent .level }}">
									<div class="bar">
										<div class="progress">{{ levelPercent .level }}%</div>
									</div>
									<div class="label">Level {{ level .level }}</div>
								</div>
							</div>
						{{ end }}
					</div>
				</div>
			</div> <!-- end grid segment -->
			<div id="scores-zone">
				{{ range _range 4 }}
					<div data-mode="{{ . }}" {{ if ne . (int $favouritemode) }} hidden{{ end }} data-loaded="0">
					</div>
				{{ end }}
			</div>
			<div class="ui modal">
				<i class="close icon"></i>
				<div class="header">
					View score
				</div>
				<div class="content">
					<table class="ui very basic table" id="score-data-table">
					</table>
				</div>
			</div>
		{{ end }}
	{{ end }}
</div>
{{ end }}
